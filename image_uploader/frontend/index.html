<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2>Image tool</h2>
<div style="display: flex; flex-direction: row; margin-right: 10px;">

    <div id="image-handling" style="display:flex; flex-direction: column;
    height: 90vh;">
        <h3>Image uploader</h3>
        <!-- upload form -->
        <div id="image-uploader">
            <form>
                <div style="display: flex; flex-direction: column;max-width: 180px;">
                    <img id="preview" src="http://placehold.it/180"
                         alt="preview"
                         style="max-width: 180px;max-height: 240px"/>
                    <input id="file-input" type="file" name="name"/>
                    <input id="upload" type="button" value="Upload">
                </div>

            </form>
        </div>

        <h3 style="margin-top: 50px;">Image cropper</h3>
        <!-- Image cropper -->
        <div id="image-cropper" >
            <img id="preview" src="http://placehold.it/180"
                 alt="crop preview" style="max-width: 180px;max-height: 240px"/>
            <input id="crop-buton" type="button" value="Crop image"/>
        </div>

    </div>
    <div id="image-list" style="width:100%; height: 90vh;">
        <!-- One image tree -->
        <div class="image-container">
            <img>
            <div class="crop-list-container"></div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script src="static/js/jquery.Jcrop.js"></script>

<script>
    $(document).ready(
        function () {

            $('#open-button').on('click', function () {
                $('#file-input').trigger('click');
            });

            $("#file-input").change(
                function (event) {
                    let target = event.target;
                    if (target.files && target.files[0]) {
                        var reader = new FileReader();

                        reader.onload = function (e) {
                            let preview = $('#preview').empty();
                            preview.attr('src', e.target.result);

                            // Transform the image into something interactive
                            preview.Jcrop({
                                onSelect: function (coords) {
                                    console.log("Coords", coords);
                                }
                            });
                        };

                        reader.readAsDataURL(target.files[0]);
                    }
                }
            );

            $("#upload").click(function () {
                let file = $("#file-input")[0].files[0];

                if (!file) {
                    alert("No image selected");
                    return;
                }
                let form = new FormData();
                console.log(file);
                form.append('file', file);

                console.log(form);
                let ajaxConfig = {
                    url: "/webservice/upload-image",
                    type: "POST",
                    enctype: 'multipart/form-data',
                    data: form,
                    processData: false,
                    contentype: false
                };
                $.ajax(ajaxConfig).done(function(response) {
                    console.log("Answered received", response);
                });
            });
        }
    );

</script>
</body>
</html>